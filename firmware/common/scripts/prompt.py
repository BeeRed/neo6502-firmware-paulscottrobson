# ***************************************************************************************
# ***************************************************************************************
#
#      Name :      prompt.py
#      Authors :   Paul Robson (paul@robsons.org.uk)
#      Date :      22nd November 2023
#      Reviewed :  No
#      Purpose :   Prompt creator (counts builds etc.)
#
# ***************************************************************************************
# ***************************************************************************************

import sys
import git
import re
#
#		This is the current version.
#
try:
    repo = git.Repo(search_parent_directories=True)
    version = repo.git.describe("--tags", "--always")
    plainVersion = version
    if repo.is_dirty():
        version += " dirty"
except:
    version = "?"
print("//\n//\tThis file is automatically generated\n//")
print("#define PROMPT \"Morpheus Firmware: {0}\\r\"".format(version))

m = re.match("^v(\\d+)\\.(\\d+)\\.(\\d+).*$",plainVersion+".0")
assert m is not None,"Cannot parse version string "+plainVersion

print("#define VERSION_MAJOR ({0})".format(m.group(1)))
print("#define VERSION_MINOR ({0})".format(m.group(2)))
print("#define VERSION_PATCH ({0})".format(m.group(3)))
